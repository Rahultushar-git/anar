<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ANAR ‚Äî Anonymous Chat</title> 
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="favicon.png" />
  <style>
    :root{
      --chat-bg: #fafafa;
      --accent: #8557B6;
    }

    html,body{height:100%;margin:0;background:#fff;font-family:Arial,Helvetica,sans-serif;color:#0b1220;}
    .app {height:100vh;display:flex;flex-direction:column;}

    .header {
      background-color: #8A5DBA;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 72px;
    }

    .header-left{ display:flex;align-items:center;gap:12px; }
    .logo{ width:150px;height:auto;object-fit:contain;border-radius:8px; }

    .coffee-btn{
      background:#fff;color:#000;text-decoration:none;
      padding:8px 16px;border-radius:20px;
      font-weight:600;font-size:0.95rem;
      box-shadow:0 2px 5px rgba(0,0,0,0.15);
    }

    .desc{ padding:10px 16px;text-align:center;font-size:0.95rem;color:#333;border-bottom:1px solid #eee; }

    /* === STATUS BAR === */
    .status-bar{
      text-align:center;
      font-size:0.7rem;
      font-weight:300;
      margin:4px 0;
    }
    .dot{
      display:inline-block;
      width:8px;height:8px;
      border-radius:50%;
      margin-right:6px;
    }
    .dot.connected{ background:#2ecc71; }
    .dot.connecting{ background:#f1c40f; }
    .dot.disconnected{ background:#e74c3c; }

    .reconnect-btn {
      display:none;
      margin-left:10px;
      padding:2px 8px;
      font-size:0.7rem;
      border:1px solid #ccc;
      border-radius:10px;
      background:#fff;
      cursor:pointer;
    }

    #chat{
      flex:1;padding:16px;background:var(--chat-bg);
      overflow-y:auto;display:flex;flex-direction:column;gap:8px;
    }

    .message-row{ display:flex;width:100%; }
    .message-row.you { justify-content:flex-end; }
    .message-row.anon{ justify-content:flex-start; }

    .msg{
      max-width:78%;
      word-break:break-word;
      border-radius:14px;
      padding:10px 14px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.04);
      font-size:0.95rem;
      line-height:1.3;
    }
    .msg.you{ background:#D0BEF4; color:#000; }
    .msg.anon{ background:#8557B6; color:#fff; }

    /* Input area */
    .input-area{
      display:flex;
      gap:6px;
      padding:10px;
      border-top:1px solid #e6e6e6;
      background:#fff;
      align-items:center;
    }
    .alias-input{
      flex:0 0 10%;   /* smaller */
      max-width:60px; /* tighter */
      min-width:50px; /* never too small */
      padding:6px 8px;
      border-radius:12px;
      border:1px solid #ccc;
      outline:none;
      font-size:0.75rem;
      text-align:center;
    }
    .msg-input{
      flex:1;
      padding:8px 12px;
      border-radius:14px;
      border:1px solid #ccc;
      outline:none;
      font-size:1rem;
    }
    .input-area button{
      background:var(--accent);
      border:none;
      padding:10px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:700;
      color:#fff;
      white-space:nowrap;
    }

    .footer{
      text-align:center;padding:8px 10px;font-size:0.85rem;
      background:#D0BEF4;border-top:1px solid #e6e6e6;color:#444;
    }

    /* Mobile fixes */
    @media (max-width:480px){
      .logo{width:120px;}
      .alias-input{flex:0 0 15%; max-width:55px; font-size:0.7rem;}
      .msg-input{font-size:0.9rem;}
      .input-area button{padding:8px 12px;font-size:0.9rem;}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="header-left">
        <img src="logo.png" alt="ANAR Logo" class="logo">
      </div>
      <a class="coffee-btn" href="https://buymeacoffee.com/rahultushar" target="_blank">‚òï Buy me a coffee</a>
    </div>
    <div class="desc">Private chat with no login, no username, and no stored messages. Refresh to clear.</div>

    <!-- STATUS BAR -->
    <div class="status-bar">
      <span id="statusDot" class="dot disconnected"></span>
      <span id="statusText">Disconnected</span>
      <button id="reconnectBtn" class="reconnect-btn">Reconnect</button>
    </div>

    <div id="chat" aria-live="polite" role="log"></div>

    <div class="input-area">
      <input id="alias" class="alias-input" type="text" maxlength="12" placeholder="Alias..." />
      <input id="msg" class="msg-input" type="text" placeholder="Type a message..." autocomplete="off" enterkeyhint="send" />
      <button id="sendBtn">Send</button>
    </div>

    <div class="footer">Made in üáÆüá≥ with ‚ù§Ô∏è</div>
  </div>

<script>
  function addMessage(text, alias, type = 'anon') {
    const chat = document.getElementById('chat');
    const row = document.createElement('div');
    row.className = 'message-row ' + (type === 'you' ? 'you' : 'anon');
    const bubble = document.createElement('div');
    bubble.className = 'msg ' + (type === 'you' ? 'you' : 'anon');
    bubble.innerHTML = `<strong>${alias}:</strong> ${text}`;
    row.appendChild(bubble);
    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
  }

  const WS_URL = 'wss://anar-aeou.onrender.com';
  let ws;

  function updateStatus(state){
    const dot = document.getElementById('statusDot');
    const text = document.getElementById('statusText');
    const btn = document.getElementById('reconnectBtn');
    dot.className = 'dot ' + state;

    if(state === 'connected'){ 
      text.textContent = 'Connected'; 
      btn.style.display = 'none';
    }
    else if(state === 'connecting'){ 
      text.textContent = 'Connecting...'; 
      btn.style.display = 'none';
    }
    else{ 
      text.textContent = 'Disconnected'; 
      btn.style.display = 'inline-block';
    }
  }

  function connect() {
    updateStatus('connecting');
    ws = new WebSocket(WS_URL);

    ws.addEventListener('open', () => updateStatus('connected'));
    ws.addEventListener('message', (ev) => {
      try {
        const msg = JSON.parse(ev.data);
        addMessage(msg.text, msg.alias, 'anon');
      } catch {
        addMessage(String(ev.data), "Anonymous", 'anon');
      }
    });
    ws.addEventListener('close', () => updateStatus('disconnected'));
    ws.addEventListener('error', () => updateStatus('disconnected'));
  }

  connect();

  document.getElementById('reconnectBtn').addEventListener('click', connect);

  function send() {
    const aliasInput = document.getElementById('alias');
    const input = document.getElementById('msg');
    const alias = aliasInput.value.trim();
    const text = input.value.trim();
    if (!text) return;

    // Show locally
    addMessage(text, alias || "You", 'you');

    // Send to others
    if (ws && ws.readyState === WebSocket.OPEN) {
      ws.send(JSON.stringify({
        alias: alias || "Anonymous",
        text: text
      }));
    }

    input.value = '';
    input.focus();
  }

  document.getElementById('sendBtn').addEventListener('click', send);
  document.getElementById('msg').addEventListener('keydown', (e)=>{
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }
  });
</script>
</body>
</html>